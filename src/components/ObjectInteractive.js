import React, { useMemo, useState } from "react";

/**
 * Компонент рендерит SVG-объект с интерактивными областями.
 * - Не использует карты/проекции — только статика SVG.
 * - Подсветка области (hover), выделение (selected), клики.
 * - Метки (markers) рендерятся поверх в координатах viewBox (x,y).
 *
 * Параметры:
 *  - viewBox: строка вида "0 0 1000 600"
 *  - regions: [{ id, name, d }] — список областей; d — path string
 *  - markers: [{ id, x, y, count? }]
 *  - onRegionClick: (region) => void
 *  - onMarkerClick: (marker) => void
 *  - enablePlaceMarker: boolean — ставить метку по клику по пустому месту
 *  - onPlaceMarker: ({ x, y }) => void — координаты во viewBox
 */
export default function ObjectInteractive({
  viewBox = "0 0 1000 600",
  regions = [],
  markers = [],
  onRegionClick,
  onMarkerClick,
  enablePlaceMarker = true,
  onPlaceMarker,
  title = "Интерактивный объект",
}) {
  const [hoverId, setHoverId] = useState(null);
  const [selectedId, setSelectedId] = useState(null);

  // получаем матрицу для конвертации clientX/Y -> SVG viewBox (для постановки меток)
  const svgRef = React.useRef(null);
  const svgPoint = useMemo(() => {
    if (typeof window === "undefined") return null;
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    return svg.createSVGPoint();
  }, []);

  const clientToSvg = (evt) => {
    if (!svgRef.current || !svgPoint) return { x: 0, y: 0 };
    const pt = svgPoint;
    pt.x = evt.clientX;
    pt.y = evt.clientY;
    const ctm = svgRef.current.getScreenCTM();
    if (!ctm) return { x: 0, y: 0 };
    const local = pt.matrixTransform(ctm.inverse());
    return { x: local.x, y: local.y };
  };

  const onBgClick = (evt) => {
    if (!enablePlaceMarker || !onPlaceMarker) return;
    // если клик пришелся именно по подложке (а не по региону/метке)
    if (evt.target.getAttribute("data-type") !== "bg") return;
    const { x, y } = clientToSvg(evt);
    onPlaceMarker({ x, y });
  };

  return (
    <div className="obj-wrap">
      <div className="obj-header">
        <h3 className="obj-title">{title}</h3>
      </div>

      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M102.183 323.231C101.447 322.92 96.6633 321.597 95.6654 321.358C94.5051 321.077 93.3447 320.788 92.1825 320.497C88.5096 319.58 84.7112 318.631 80.9361 317.985C79.9442 317.815 78.9284 317.671 77.9467 317.531C76.2964 317.297 74.5899 317.055 72.9252 316.685C72.4179 316.573 71.9064 316.456 71.3926 316.34C69.024 315.802 66.5742 315.245 64.1841 314.972L59.882 314.478C58.874 314.362 57.8642 314.222 56.8526 314.081C55.2674 313.861 53.6278 313.633 52.0181 313.508L51.6632 313.482C49.8545 313.345 47.9837 313.205 46.1445 312.99C45.0128 312.86 43.8399 312.82 42.7052 312.78C41.6721 312.744 40.6044 312.708 39.551 312.604C39.2355 312.571 38.8578 312.554 38.4647 312.535C37.8809 312.508 37.278 312.479 36.7564 312.403L36.3602 312.345L36.377 311.964C36.3835 311.82 36.3889 311.666 36.3853 311.54C35.9802 311.299 35.3976 311.144 34.8324 310.994C34.3161 310.856 33.7819 310.715 33.3392 310.498C32.9627 310.306 32.5164 310.047 32.1017 309.807L31.7295 309.592C31.6458 309.543 31.5777 309.506 31.5203 309.476C31.3291 309.373 31.1314 309.267 31.0674 309.026C31.0453 308.943 31.0447 308.865 31.0597 308.789C30.9264 308.793 30.7872 308.812 30.6563 308.829C30.489 308.85 30.3325 308.869 30.204 308.869C30.152 308.869 30.1036 308.866 30.0582 308.861C28.8028 308.711 27.5295 308.309 26.0513 307.597C25.6014 307.377 24.6268 306.992 23.5943 306.585C21.0417 305.577 19.3382 304.884 18.9295 304.451L18.7556 304.268L18.8369 304.033C19.5617 301.947 20.3659 299.861 21.1439 297.844L21.4408 297.075C21.7808 296.191 22.1901 295.319 22.5863 294.476C23.0302 293.532 23.4891 292.555 23.8393 291.58C24.8073 288.873 25.7938 286.478 26.944 284.045L26.9948 283.938L27.0969 283.87C27.9036 283.337 28.7622 282.859 29.5922 282.397C30.2452 282.034 30.9204 281.658 31.5622 281.26C31.7098 281.117 32.373 280.412 32.4543 280.31C33.525 278.81 35.121 275.544 34.4697 274.405C34.1142 273.774 33.4593 273.232 32.8265 272.709C32.6526 272.565 32.4817 272.424 32.321 272.284C32.1131 272.105 31.9051 271.921 31.696 271.736C30.835 270.973 29.9441 270.185 28.9128 269.705C28.5136 269.519 28.1175 269.27 27.7345 269.03C27.5624 268.922 27.3939 268.816 27.2302 268.719L27.0808 268.631L27.0342 268.47C26.8245 267.747 27.1358 266.235 27.4722 264.748L27.5594 264.358C27.6819 263.771 27.6956 263.172 27.71 262.537C27.7225 262.006 27.7351 261.456 27.8175 260.912C27.8414 260.764 27.8618 260.622 27.8821 260.483C27.9962 259.695 28.1043 258.949 28.5979 258.198C29.7433 256.445 29.6645 254.044 29.594 251.926L29.5874 251.729C29.5575 250.901 29.7409 249.984 29.9184 249.098C30.0009 248.686 30.0809 248.285 30.1353 247.909C30.2225 247.307 30.746 246.712 30.967 246.485L31.1087 246.339L31.3178 246.349C31.4678 246.356 31.6022 246.36 31.7259 246.36C32.3348 246.36 32.6514 246.273 33.4025 246.026L36.521 244.993C38.672 244.283 41.8926 239.726 42.7112 237.267C42.3228 236.185 41.6793 235.273 40.9999 234.31C40.8637 234.117 40.507 233.604 40.507 233.604L40.5171 233.462C40.5422 233.107 40.9294 232.7 42.244 231.645C42.2649 231.628 42.2852 231.612 42.3049 231.596C42.0372 231.517 41.7833 231.403 41.7098 231.149L41.6942 231.096L41.6936 231.039C41.6913 230.69 41.6763 230.417 41.6638 230.188C41.6166 229.31 41.6309 228.955 42.235 227.936L42.3533 227.736L42.5935 227.72C42.719 227.712 42.8881 227.706 43.0799 227.7C43.4462 227.688 44.3496 227.659 44.7015 227.553C44.7225 227.322 44.7117 227.066 44.6705 226.986L44.5605 226.835L44.6065 226.665L44.7481 226.022L45.3068 225.706L45.7466 224.475L45.8792 224.395C46.4074 224.074 46.8502 223.637 47.3199 223.175C47.4352 223.06 47.7578 222.748 47.7578 222.748L49.2014 222.429L49.3305 222.477C50.9235 223.064 51.0944 223.242 52.2087 224.395L52.2709 224.459C52.6138 224.817 53.0883 225.022 53.5902 225.237C53.9469 225.391 54.3156 225.549 54.6687 225.773C54.7775 225.827 54.9442 225.91 55.0099 226.109C55.0398 226.201 55.0553 226.346 54.9603 226.518C54.8975 226.631 54.9125 226.779 55.0045 226.958C55.1915 227.322 55.5823 227.59 55.7048 227.611C55.7526 227.613 55.8153 227.614 55.8805 227.614C56.0472 227.616 56.2366 227.617 56.3997 227.656C56.8873 227.779 57.1574 227.874 57.1633 228.407C57.1639 228.467 57.1645 228.545 57.1741 228.648C57.3916 228.88 57.5905 229.109 57.7865 229.334C58.2705 229.89 58.7282 230.414 59.3849 230.897C59.7177 231.14 59.9209 231.455 60.118 231.761C60.2698 231.997 60.4138 232.22 60.6044 232.381L60.7162 232.476L60.7454 232.616C60.8243 232.992 60.8709 233.215 60.9916 233.464C61.3143 233.627 61.5162 233.839 61.7289 234.062L61.8138 234.151L61.8514 234.285C61.8909 234.485 61.8968 234.67 61.9016 234.834C61.9064 234.993 61.9112 235.134 61.9423 235.274C62.0379 235.359 62.1293 235.439 62.2183 235.515C62.6079 235.853 62.9778 236.174 63.3148 236.696L64.4883 237.029L64.5767 237.141C65.1461 237.863 65.8841 240.487 65.9229 241.558C66.3113 241.953 66.4481 242.28 66.5611 242.548C66.6979 242.874 66.7977 243.109 67.3653 243.497C68.0686 243.977 68.7515 245.337 68.5412 246.354C68.8197 246.358 69.1298 246.453 69.45 246.563C69.5994 246.467 69.7464 246.389 69.9233 246.303L70.0661 246.234L70.9223 246.41L71.288 247.067L71.38 247.074L71.8347 247.395L71.8652 247.563C71.8861 247.675 71.9082 247.798 71.9309 247.896C71.9913 247.856 72.0737 247.798 72.1825 247.712L72.4932 247.466L73.3697 248.279L73.3966 248.627C73.4349 248.641 73.4725 248.657 73.5096 248.671C73.4898 248.51 73.5078 248.407 73.5651 248.151L73.6601 247.713L74.9418 247.19C77.3713 246.199 79.8839 245.174 82.3247 244.082C82.5655 243.878 83.8275 242.732 84.5206 242.102C84.9275 241.732 85.249 241.441 85.3272 241.372C85.3971 241.309 85.4766 241.242 85.5597 241.173C85.7849 240.985 86.0365 240.775 86.1249 240.573L86.0962 240.498C85.8291 239.803 85.5758 239.141 85.4653 238.376C85.2119 238.309 84.9574 238.259 84.6927 238.207C84.1931 238.108 83.6763 238.007 83.1469 237.787L82.9993 237.725L82.6832 237.134L82.7782 236.085L82.9527 235.971C83.2473 235.779 83.3345 234.71 83.3626 234.358L83.3674 234.303L83.3494 234.271C83.0632 233.56 82.7256 232.994 82.3671 232.394C81.9417 231.681 81.5013 230.943 81.1667 229.962L81.1572 229.935L81.1159 229.72C80.9731 228.978 80.9068 228.256 80.8423 227.557C80.8064 227.174 80.7712 226.787 80.7228 226.393C80.5095 224.689 80.0888 222.925 79.6831 221.218C79.572 220.752 79.4614 220.288 79.3557 219.829L79.3312 219.723L79.4764 219.25C79.5797 218.914 79.6604 218.652 79.6903 218.526C79.5738 218.371 79.456 218.155 79.3521 217.69L77.6002 216.8L77.4753 216.585C77.2763 216.248 77.051 215.865 77.1395 215.333L77.1592 215.213L77.8995 214.397L78.0316 214.363C78.3996 214.268 78.601 214.226 78.8173 214.226C79.0246 214.226 79.2045 214.266 79.4764 214.329L79.9102 214.425L80.001 214.511C80.1982 214.698 80.3708 214.864 80.525 215.013C81.6513 216.102 81.6949 216.144 83.411 216.144L83.9356 216.142L84.8934 216.881C84.9902 216.757 85.0906 216.632 85.2006 216.524C85.7676 215.958 86.3478 215.613 86.9095 215.28C87.5942 214.874 88.1863 214.522 88.6745 213.819C89.1884 213.089 91.9268 209.901 92.4329 209.602L92.553 209.531C93.0639 209.224 93.5921 208.907 94.244 208.775C94.4555 208.734 94.6975 208.699 94.9496 208.664C95.4288 208.596 95.9726 208.52 96.3209 208.375C96.5551 208.278 96.6012 208.204 96.6854 208.07C97.029 207.523 97.4843 207.283 99.4155 207.211C99.8492 207.197 101.027 206.779 101.417 206.52C101.444 205.528 100.37 203.397 99.7214 202.575L99.6957 202.563C99.5272 202.492 99.4256 202.449 99.321 202.373C99.2559 202.328 99.1914 202.267 99.0832 202.156C99.0348 202.107 98.7851 201.86 98.7851 201.86L98.7116 201.272L98.7552 201.171C98.9476 200.723 99.2655 200.34 99.5738 199.969C99.8522 199.635 100.116 199.316 100.255 198.99C100.148 198.642 100.122 198.18 100.1 197.765C100.092 197.624 100.085 197.494 100.075 197.389L100.055 197.184L100.67 196.628L101.315 196.48C101.335 196.243 101.4 195.961 101.564 195.766L101.736 195.562L102.005 195.615C102.074 195.629 102.165 195.645 102.267 195.663C102.733 195.743 103.079 195.807 103.275 195.908C103.96 196.25 104.432 196.411 104.751 196.411C104.956 196.411 105.109 196.344 105.338 196.242C105.711 196.078 106.221 195.854 107.176 195.854C107.361 195.854 107.564 195.862 107.79 195.881L107.915 195.893L108.62 196.041C109.317 196.194 109.777 196.295 110.115 196.295C110.648 196.295 110.964 196.033 112.088 195.034C112.292 194.851 112.514 194.688 112.73 194.529C112.967 194.356 113.189 194.191 113.379 194.011C113.606 193.796 113.807 193.58 114.006 193.367C114.323 193.028 114.652 192.677 115.066 192.34C116.322 191.329 116.443 191.276 117.648 190.888L118.121 190.734C120.198 190.057 122.103 189.457 124.393 188.988C124.839 188.895 125.311 188.637 125.768 188.387C126.053 188.231 126.348 188.069 126.646 187.942L128.022 187.348C127.842 187.168 127.652 186.916 127.575 186.564L127.349 186.348L127.225 185.762L127.422 185.265L127.54 185.19C127.801 185.022 128.072 184.841 128.312 184.63L128.31 184.58L127.466 183.77L127.861 183.475C128.148 183.261 128.62 183.221 129.392 183.221L130.122 183.225C130.387 183.225 130.698 183.221 130.94 183.192C130.969 183.059 130.948 182.939 130.918 182.782C130.88 182.573 130.832 182.313 130.931 182.013L131.007 181.781L131.257 181.726C131.494 181.673 131.767 181.646 132.045 181.646C132.134 181.646 132.223 181.648 132.311 181.654L132.316 181.611C132.257 181.495 132.194 181.377 132.13 181.258C131.966 180.951 131.797 180.635 131.685 180.314C131.529 179.847 132.36 176.896 132.371 176.873L132.429 176.748L132.879 176.497L133.408 176.537L133.464 176.591C133.581 176.392 133.604 176.167 133.628 175.934C133.661 175.615 133.698 175.254 134.033 175.035L134.127 174.974L134.24 174.963C134.415 174.946 134.587 174.938 134.757 174.938C135.521 174.938 136.248 175.095 136.95 175.247C137.467 175.359 138.001 175.474 138.543 175.525L138.938 175.562L138.969 176.884L138.847 177.011C138.762 177.097 138.593 177.242 138.394 177.411C138.286 177.502 138.132 177.633 137.98 177.767C138.321 177.733 138.662 177.684 139.013 177.634L139.277 177.598L139.484 177.239L139.811 177.107C139.901 176.625 140.096 175.334 140.173 174.801C139.857 174.564 139.629 174.471 139.441 174.394C138.672 174.078 138.58 173.725 138.453 172.061C138.423 171.624 138.614 170.653 138.85 170.254L138.926 170.126L139.067 170.069C139.238 170.001 139.434 169.967 139.65 169.967C140.49 169.967 141.537 170.483 142.3 170.859C142.499 170.956 142.67 171.041 142.798 171.095L142.936 171.153L143.009 171.279C143.261 171.716 143.465 172.424 143.632 173.438C143.831 173.446 144.052 173.459 144.284 173.474C144.693 173.499 145.115 173.524 145.522 173.524C146.188 173.524 146.64 173.451 146.864 173.307L147.077 173.169L147.31 173.275C147.484 173.355 147.657 173.491 147.841 173.634C147.959 173.727 148.148 173.875 148.249 173.923C148.329 173.901 148.414 173.877 148.498 173.852C148.912 173.734 149.34 173.612 149.806 173.602L149.993 173.598C149.993 173.598 150.168 173.758 150.182 173.768C150.194 173.764 150.21 173.759 150.226 173.754C150.319 173.726 150.433 173.692 150.587 173.662L150.847 173.611L151.011 173.795L151.037 173.603C151.037 173.603 151.723 173.455 151.911 173.413C152.58 173.263 153.271 173.109 153.989 173.058L154.161 173.046L155.121 173.752L155.218 174.275C155.377 174.318 155.608 174.343 155.805 174.363C156.142 174.399 156.49 174.436 156.787 174.557L157.021 174.652L157.054 174.892C157.44 177.679 157.253 178.305 156.994 178.574L156.965 178.605L156.552 178.894L156.396 178.889C156.243 178.884 156.09 178.881 155.937 178.881C155.254 178.881 154.542 178.933 153.815 179.035L153.841 179.156L154.344 179.447L154.379 179.479C154.741 179.808 154.76 180.519 154.74 180.908C154.962 180.999 155.459 181.109 156.294 181.109C156.721 181.109 157.152 181.076 157.389 181.025L157.517 180.997L158.572 181.36L159.592 180.907C159.72 180.85 159.851 180.798 159.982 180.745C160.465 180.552 160.921 180.369 161.169 180.024C161.186 179.998 161.199 179.964 161.212 179.933C161.247 179.854 161.292 179.749 161.387 179.638C161.35 179.367 161.313 179.064 161.405 178.747L161.446 178.607L161.978 178.229L162.671 178.24L162.802 178.383C163.026 178.627 163.209 178.995 163.336 179.3L163.868 179.154L164.494 179.407L165.253 180.534L165.103 180.762C165.053 180.839 164.992 180.926 164.926 181.02C164.768 181.247 164.521 181.6 164.424 181.841L164.497 181.942C164.529 181.946 164.563 181.948 164.598 181.948C164.922 181.948 165.676 181.765 167.079 180.54C167.222 180.404 167.409 180.391 167.499 180.385C167.84 180.31 168.168 180.181 168.46 180.053C168.392 179.851 168.178 179.395 167.613 178.397L167.486 178.171C166.924 177.103 168.51 175.301 170.136 173.678C170.234 173.581 170.308 173.506 170.352 173.46L170.497 173.306L172.273 173.409C173.489 173.482 174.339 173.921 174.959 174.242C175.263 174.399 175.55 174.548 175.702 174.548C175.771 174.542 175.825 174.515 175.915 174.469C176.064 174.392 176.266 174.289 176.553 174.289C176.636 174.289 176.723 174.298 176.809 174.315C177.054 174.367 177.26 174.392 177.444 174.392C178.115 174.392 178.441 174.042 179.015 173.191C179.002 172.791 179.036 172.217 179.309 171.976C179.612 171.747 179.896 171.646 180.204 171.646C180.474 171.646 180.709 171.724 180.936 171.799C181.151 171.87 181.353 171.937 181.583 171.937C181.949 171.937 182.363 171.758 182.848 171.39C182.86 171.194 182.84 170.993 182.792 170.833L182.718 170.587L182.912 170.409C183.137 170.202 183.587 169.983 183.976 169.983H184.055L184.129 170.008C185.501 170.481 185.565 171.023 185.555 171.867C185.552 172.131 185.548 172.431 185.598 172.803C185.65 173.21 185.74 173.637 185.826 174.048C185.871 174.265 185.916 174.481 185.957 174.694C186.01 174.784 186.194 175.016 186.359 175.197C186.466 175.314 186.594 175.442 186.726 175.575C187.035 175.885 187.355 176.207 187.565 176.528C187.89 177.03 187.993 177.354 188.069 177.59C188.17 177.907 188.216 178.051 188.929 178.559C188.938 178.565 189.345 178.867 189.391 179.169L189.649 180.614C189.711 180.646 189.821 180.688 189.898 180.717C190.261 180.855 190.757 181.045 190.883 181.544L190.913 181.666L190.748 182.114C190.971 181.956 191.37 181.714 191.708 181.706L192.054 181.697L192.084 181.795L192.124 181.727L192.678 181.764C192.7 181.577 192.744 181.392 192.828 181.259L192.938 181.084L193.511 181.008L193.611 181.04C193.781 181.094 193.904 181.221 193.979 181.418C193.992 181.451 194.004 181.486 194.014 181.525C194.386 181.401 195.019 181.312 195.408 181.276L195.305 181.045L195.443 180.31L195.91 180.424C195.954 180.435 195.996 180.445 196.034 180.457C196.071 180.273 196.153 180.077 196.33 179.84L196.711 179.33L197.18 180.013L197.342 179.898L197.52 180.366L198.289 180.001L198.22 180.554C198.299 180.523 198.387 180.498 198.487 180.487L198.683 180.467L198.831 180.591C198.922 180.666 199.082 180.759 199.192 180.806C199.413 180.671 199.707 180.562 199.971 180.562C200.032 180.562 200.091 180.568 200.146 180.579L200.406 180.633L200.45 180.773L200.764 180.67L201.487 180.911L201.411 181.559C201.422 181.563 201.601 181.649 201.601 181.649H201.986C201.99 181.634 202.094 181.276 202.094 181.276L202.847 181.31L203.015 181.438C203.093 181.501 203.159 181.55 203.209 181.585C203.398 181.5 203.599 181.432 203.795 181.366C204.215 181.225 204.61 181.091 204.777 180.842L204.897 180.661L205.56 180.615L205.66 180.656C205.863 180.739 205.991 180.906 206.074 181.067C206.197 181.099 206.414 181.13 206.742 181.13C206.811 181.13 206.876 181.129 206.936 181.126C206.643 180.865 206.586 180.692 206.573 180.558L206.566 180.488L206.796 179.577L207.696 179.788C207.703 179.777 207.71 179.766 207.718 179.756C207.844 179.571 208.034 179.292 208.417 179.292C208.57 179.292 208.723 179.338 208.897 179.437L209.164 179.588L209.109 179.879C209.073 180.069 209.035 180.21 208.963 180.343C209.02 180.352 209.088 180.357 209.164 180.357C209.287 180.357 209.429 180.343 209.575 180.316C209.704 180.293 209.814 180.259 209.898 180.231L210.065 180.176L210.226 180.242C210.77 180.466 210.928 180.567 211.033 180.988C211.109 180.867 211.202 180.76 211.309 180.684L211.362 180.646L211.426 180.624C211.57 180.575 211.698 180.512 211.824 180.452C212.104 180.318 212.419 180.167 212.841 180.148L213.076 179.918L213.348 180.01C213.882 180.19 214.045 180.379 214.249 180.671C214.283 180.72 214.321 180.774 214.368 180.835C214.956 180.839 215.359 181.207 215.681 181.503C215.737 181.554 215.792 181.605 215.847 181.653L216.007 181.791L215.993 181.995C215.975 182.26 216 182.349 216.007 182.369C216.005 182.361 216.014 182.358 216.03 182.358C216.057 182.358 216.104 182.367 216.141 182.375C216.368 182.422 216.713 182.493 217.099 182.758L217.222 182.842L217.344 183.223L217.759 183.196L217.905 183.387C217.966 183.467 218.013 183.489 218.122 183.489C218.221 183.489 218.322 183.471 218.423 183.455C218.569 183.432 218.713 183.411 218.849 183.411C219.148 183.411 219.396 183.506 219.585 183.694L219.696 183.803L219.709 183.953C219.743 184.335 219.807 184.396 220.072 184.649C220.127 184.701 220.187 184.758 220.252 184.823L220.901 185.001L220.987 185.097C221.255 185.391 221.387 185.653 221.444 186.003L221.468 186.15L221.39 186.28C221.3 186.43 221.137 186.61 220.941 186.742C220.948 186.749 221.08 186.857 221.08 186.857L221.111 187C221.224 187.533 221.074 187.984 220.95 188.277L220.889 188.422L220.608 188.562L220.575 188.81C220.665 188.947 220.721 189.075 220.734 189.265C220.789 189.308 220.851 189.355 220.915 189.405C221.218 189.637 221.563 189.901 221.745 190.12L221.838 190.231C221.838 190.231 221.845 190.491 221.848 190.527C221.905 190.601 221.961 190.676 222.037 190.799L222.149 190.981L221.975 191.385C222.032 191.46 222.16 191.589 222.228 191.657C222.234 191.663 222.241 191.67 222.247 191.676C222.304 191.656 222.366 191.628 222.394 191.607L222.589 191.467L222.819 191.545C222.992 191.604 223.175 191.714 223.37 191.829C223.501 191.907 223.711 192.032 223.817 192.068L224.118 191.966L224.351 192.384L224.421 192.34L225.002 192.422C225.27 192.278 225.332 192.264 225.694 192.223L225.821 192.209L225.957 192.258C226.342 192.428 226.602 192.761 226.811 193.027C226.827 193.049 226.844 193.07 226.861 193.091C226.88 193.092 226.901 193.094 226.925 193.094C227.058 193.094 227.149 193.064 227.17 193.05L227.311 192.893L227.512 192.916L227.77 192.926C227.88 192.824 228.033 192.685 228.256 192.685C228.427 192.685 228.568 192.761 228.678 192.91C229.579 193.187 230.419 193.499 230.81 193.97L232.398 194.314L232.614 194.671L232.989 194.849L233.195 195.323L233.133 195.397C233.251 195.438 233.389 195.485 233.506 195.526C234.379 195.823 235.574 196.231 235.913 197.071C236.049 197.409 236.031 197.769 235.859 198.141H236.068L236.163 198.444C236.251 198.721 236.445 198.908 236.633 199.09C236.821 199.271 237.015 199.459 237.079 199.726L237.109 199.85L236.98 200.186L236.95 200.228C236.864 200.352 236.728 200.428 236.585 200.475L236.659 200.519L236.714 200.64C236.767 200.756 236.782 200.883 236.775 201.004L236.809 201.007L236.879 201.039C237.041 201.112 237.473 201.384 237.519 201.752L237.535 201.88L237.475 201.994C237.46 202.023 237.432 202.068 237.398 202.12C237.384 202.142 237.362 202.176 237.341 202.211C237.379 202.258 237.418 202.304 237.449 202.331C238.396 202.845 238.821 203.776 239.163 204.524C239.493 205.246 239.699 205.657 240.114 205.703L240.552 205.752C241.532 205.863 242.458 205.969 243.425 205.969L243.662 205.967C244.028 205.967 244.272 206.165 244.434 206.296C244.484 206.335 244.551 206.39 244.582 206.403C244.623 206.422 244.687 206.443 244.765 206.47C245.248 206.637 246.055 206.918 246.25 207.502C246.312 207.691 246.335 207.987 246.088 208.323L245.79 208.725C245.255 209.441 244.869 209.958 244.656 210.783C244.378 211.87 244.4 211.962 244.609 212.836L244.723 213.32L244.696 213.418C244.596 213.781 244.367 214.169 244.124 214.579C243.745 215.22 243.316 215.945 243.562 216.344C243.823 216.765 244.168 217.173 244.534 217.604C245.008 218.164 245.496 218.74 245.814 219.378L245.824 219.38L246.435 220.104L246.438 220.251C246.45 221.058 245.734 221.913 245.211 222.538C245.119 222.648 245.034 222.75 244.961 222.842C244.808 223.037 244.729 223.57 244.667 223.998C244.599 224.457 244.529 224.932 244.358 225.281C243.937 226.15 243.467 226.559 243.012 226.955C242.581 227.329 242.175 227.683 241.741 228.469C241.736 228.497 241.703 228.694 241.692 228.75C241.811 228.868 242.063 229.036 242.243 229.155C242.848 229.558 243.601 230.059 243.687 230.881C243.727 231.277 243.715 232.656 243.703 234.115C243.695 235.079 243.685 236.242 243.7 236.706C243.806 236.746 243.923 236.78 244.038 236.814L244.284 236.887L244.369 236.983C244.593 237.24 244.718 237.578 244.838 237.905C244.926 238.144 245.017 238.39 245.126 238.533L245.228 238.581C246.548 238.992 247.378 239.358 247.705 240.002C248.062 240.703 247.744 241.516 247.219 242.863C247.122 243.111 247.018 243.378 246.907 243.67C246.818 243.906 246.817 244.132 246.816 244.393C246.815 244.676 246.815 244.995 246.686 245.335C245.968 247.254 245.264 248.588 244.36 250.119C244.294 250.23 244.202 250.38 244.094 250.558C243.588 251.385 242.295 253.497 242.173 254.313C242.267 254.356 242.44 254.426 242.525 254.46C242.608 254.494 242.681 254.524 242.736 254.55C242.85 254.604 242.985 254.657 243.123 254.712C243.406 254.825 243.698 254.941 243.928 255.093C244.439 255.434 244.696 255.998 244.582 256.532C244.478 257.021 244.081 257.381 243.52 257.495C243.308 257.535 243.093 257.56 242.881 257.583C242.778 257.594 242.675 257.606 242.574 257.619C242.108 257.682 241.541 258.099 240.939 258.54C240.068 259.179 239.081 259.905 237.923 259.905C237.419 259.905 236.922 259.764 236.446 259.486L236.364 259.438L236.31 259.362C236.124 259.103 236.162 258.784 236.193 258.527C236.205 258.434 236.223 258.28 236.21 258.231C236.128 258.157 235.688 257.886 233.94 257.886C233.279 257.886 232.595 257.923 232.046 257.953C231.649 257.975 231.314 257.992 231.088 257.992C230.902 257.992 230.592 257.932 230.013 257.815C229.317 257.674 228.364 257.482 227.81 257.482C227.75 257.482 227.694 257.485 227.645 257.49C227.627 257.502 227.505 257.566 227.338 257.648C226.742 257.941 225.745 258.43 224.682 258.621C224.664 258.663 224.569 258.96 224.505 259.157C224.318 259.741 224.063 260.539 223.225 260.714L223.096 260.741L222.973 260.697C222.872 260.661 222.749 260.612 222.612 260.556C222.252 260.411 221.71 260.192 221.391 260.19C221.169 260.497 220.959 261.413 221.05 261.721C221.222 261.836 221.438 261.93 221.665 262.028C222.002 262.173 222.351 262.324 222.632 262.58L222.738 262.676L222.763 262.814C222.832 263.186 222.697 263.54 222.589 263.824L222.441 264.233C222.038 265.371 222.038 265.371 221.967 266.295L221.915 266.937C221.873 267.386 221.726 267.744 221.583 268.09C221.493 268.307 221.408 268.513 221.355 268.732L221.34 268.792C220.981 270.274 220.722 271.344 220.369 272.224C219.636 274.064 218.503 275.004 215.682 276.729C215.109 277.079 215.046 277.269 215.04 277.32C215.022 277.471 215.326 277.765 215.595 278.024C215.862 278.283 216.166 278.576 216.422 278.941L216.526 279.09L216.412 279.604L216.318 279.694C216.157 279.847 215.92 279.899 215.376 279.899C215.158 279.899 214.927 279.889 214.752 279.883C214.657 279.879 214.42 279.875 214.42 279.875C213.109 279.875 212.115 280.364 211.389 280.72C210.915 280.953 210.542 281.137 210.184 281.148C209.976 281.155 209.769 281.158 209.566 281.158C208.642 281.158 207.789 281.09 206.886 281.017C206.59 280.994 206.29 280.97 205.982 280.948C205.556 280.916 205.028 280.906 204.47 280.896C203.326 280.874 202.03 280.849 201.156 280.628C200.741 280.524 200.416 280.33 200.102 280.141C199.816 279.969 199.544 279.805 199.211 279.722C199.199 279.809 199.189 279.905 199.178 280.002C199.118 280.547 199.043 281.225 198.547 281.579L198.522 281.597L198.494 281.612C198.376 281.673 198.23 281.698 197.989 281.698C197.703 281.698 197.31 281.661 197.03 281.633C196.523 282.793 196.291 286.664 196.162 288.81C196.027 291.073 196 291.298 195.843 291.484L195.764 291.577L195.421 291.696L195.39 291.702C192.986 292.192 192.977 292.224 192.544 293.89C192.448 294.257 192.335 294.691 192.178 295.209C191.921 296.051 191.71 296.52 191.555 296.862C191.254 297.53 191.242 297.556 191.708 299.596C191.72 299.654 191.745 299.738 191.775 299.839C191.95 300.442 192.074 300.929 191.934 301.248L191.846 301.45L191.621 301.499C191.151 301.601 190.673 301.622 190.21 301.643C189.726 301.665 189.269 301.685 188.856 301.794C188.705 301.835 188.399 301.981 188.103 302.123C187.393 302.462 186.859 302.702 186.454 302.702C186.376 302.702 186.303 302.693 186.235 302.676C185.772 302.561 185.388 302.373 185.018 302.191C184.596 301.984 184.198 301.789 183.701 301.714L182.03 301.471C181.915 301.454 181.763 301.436 181.591 301.413C180.119 301.229 179.252 301.075 178.888 300.795C178.663 300.624 178.495 300.347 178.334 300.079C178.306 300.033 178.273 299.978 178.237 299.922C178.226 299.943 178.215 299.964 178.203 299.985C177.948 300.454 177.631 301.038 176.839 301.038C176.654 301.038 176.459 301.004 176.243 300.936C175.726 300.773 175.25 300.613 174.796 300.459C173.029 299.864 171.634 299.394 169.505 299.328C168.544 299.29 168.336 298.067 168.253 296.752C168.225 296.354 168.21 295.939 168.196 295.551C168.178 295.024 168.154 294.381 168.09 294.12C167.711 293.956 166.26 293.812 165.373 293.722C164.431 293.628 163.617 293.547 163.171 293.427L162.997 293.381C161.542 292.989 160.491 292.706 159.451 292.706C158.565 292.706 157.657 292.913 156.506 293.375C155.722 293.695 154.49 294.586 153.404 295.372C152.884 295.747 152.395 296.101 151.992 296.366C151.067 296.974 150.06 297.475 149.086 297.959C148.118 298.439 147.119 298.936 146.228 299.528C144.879 300.421 143.594 301.08 142.406 301.659C140.623 302.523 136.804 304.859 135.1 306.012C134.705 306.277 134.266 306.465 133.842 306.646C133.48 306.799 133.139 306.945 132.836 307.131C131.94 307.675 131.013 308.201 130.116 308.708C128.632 309.55 127.097 310.419 125.685 311.389C125.575 311.453 125.501 311.474 125.453 311.488C124.518 312.128 123.795 312.872 123.028 313.661C122.771 313.925 122.509 314.194 122.232 314.468C121.993 314.706 121.739 314.933 121.485 315.161C121.121 315.488 120.777 315.797 120.469 316.137C120.356 316.263 120.236 316.432 120.107 316.613C119.659 317.241 119.101 318.022 118.251 318.095C117.757 318.134 117.276 318.163 116.798 318.192C115.606 318.263 114.479 318.331 113.308 318.549C112.778 318.645 112.315 318.896 111.825 319.161C111.135 319.534 110.42 319.92 109.457 319.931C109.259 319.931 109.063 319.909 108.869 319.887C108.713 319.87 108.559 319.851 108.409 319.851C106.55 319.866 104.044 319.887 102.042 320.383C101.991 320.395 101.974 320.408 101.974 320.408C101.888 320.628 102.471 321.507 102.663 321.794C102.866 322.1 102.983 322.28 103.036 322.433L103.072 322.536L102.957 323.127L102.32 323.282L102.183 323.231ZM190.602 182.225C190.612 182.217 190.624 182.208 190.639 182.197L190.599 182.224C190.6 182.225 190.601 182.225 190.602 182.225Z"
        fill="#F4F6FA"
      ></path>
      <svg
        ref={svgRef}
        className="obj-svg"
        viewBox={viewBox}
        onClick={onBgClick}
      >
        {/* Подложка, чтобы ловить клики в "пустых" местах */}
        <rect
          data-type="bg"
          x="0"
          y="0"
          width="100%"
          height="100%"
          fill="#f3f6fa"
          rx="24"
          ry="24"
        />

        {/* Области */}
        <g className="obj-regions">
          {regions.map((r) => {
            const isHover = r.id === hoverId;
            const isSel = r.id === selectedId;
            return (
              <path
                key={r.id}
                d={r.d}
                className={`obj-region ${isHover ? "is-hover" : ""} ${
                  isSel ? "is-selected" : ""
                }`}
                onMouseEnter={() => setHoverId(r.id)}
                onMouseLeave={() => setHoverId(null)}
                onClick={(e) => {
                  e.stopPropagation();
                  setSelectedId(r.id);
                  onRegionClick?.(r);
                }}
              >
                <title>{r.name}</title>
              </path>
            );
          })}
        </g>

        {/* Метки */}
        <g className="obj-markers">
          {markers.map((m) => (
            <g
              key={m.id}
              className="obj-marker"
              transform={`translate(${m.x} ${m.y})`}
              onClick={(e) => {
                e.stopPropagation();
                onMarkerClick?.(m);
              }}
            >
              <circle r="14" className="obj-marker__halo" />
              <circle r="12" className="obj-marker__dot" />
              {typeof m.count === "number" && (
                <text className="obj-marker__count" y="4" textAnchor="middle">
                  {m.count}
                </text>
              )}
              {/* Пиктограмма */}
              <path
                className="obj-marker__icon"
                d="M-6 3h12v3h-12zM-5 1l5-4 5 4v1h-10z"
              />
            </g>
          ))}
        </g>
      </svg>
    </div>
  );
}
